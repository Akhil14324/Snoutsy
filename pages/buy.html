<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Pets - Snoutsy</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/buy-sell.css">
    <link rel="shortcut icon" href="../assets/Favicon.ico" type="image/jpeg">
</head>
<body>
    <header class="header">
        <a href="../index.html" class="logo"><i class="fa-solid fa-paw"></i>Snoutsy</a>
        <nav class="navbar">
            <a href="../index.html">Home</a>
            <a href="./services.html">Services</a>
            <a href="./about.html">About Us</a>
            <a href="./contact.html">Contact Us</a>
            <a href="./buy.html" class="active">Buy</a>
            <a href="./sell.html">Sell</a>
            <a href="./login.html" class="login-btn" id="login-link">Login</a>
            <div id="user-info" class="user-info" style="display: none;">
                <a href="./profile.html" class="user-profile-link">
                    <img id="user-photo" src="" alt="User" class="user-photo">
                    <span id="user-name" class="user-name"></span>
                </a>
                <button id="logout-btn" class="logout-btn">Logout</button>
            </div>
        </nav>
        <i id="menu-btn" class="fas fa-bars"></i>
    </header>

    <!-- Buy Pets Section -->
    <section class="buy-sell-section">
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">Buy Pets</h1>
                <p class="page-subtitle">Find your perfect pet companion from verified sellers</p>
            </div>

            <!-- Search and Filter Bar -->
            <div class="search-filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="search-input" placeholder="Search pets by name, breed, or type...">
                </div>
                <div class="filter-box">
                    <select id="filter-type" class="filter-select">
                        <option value="all">All Types</option>
                        <option value="dog">Dogs</option>
                        <option value="cat">Cats</option>
                        <option value="bird">Birds</option>
                        <option value="other">Other</option>
                    </select>
                    <select id="filter-price" class="filter-select">
                        <option value="all">All Prices</option>
                        <option value="0-5000">₹0 - ₹5,000</option>
                        <option value="5000-10000">₹5,000 - ₹10,000</option>
                        <option value="10000-20000">₹10,000 - ₹20,000</option>
                        <option value="20000+">₹20,000+</option>
                    </select>
                </div>
            </div>

            <!-- Pets Grid -->
            <div id="pets-grid" class="pets-grid">
                <!-- Pet listings will be dynamically inserted here -->
                <div class="empty-state">
                    <i class="fas fa-dog" style="font-size: 5rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <h3>No pets available yet</h3>
                    <p>Check back soon for new pet listings!</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <section class="footer">
        <div class="footer-content">
           <h3><i class="fa-solid fa-paw"></i>Snoutsy</h3> 
           <p>Snoutsy is a trusted platform for buying, selling, and adopting pets. We connect verified users to ensure secure and responsible pet ownership.</p>
           <ul class="socials">
            <li><a href="#"><i class="fa fa-facebook"></i></a></li>
            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
            <li><a href="#"><i class="fa-brands fa-google"></i></a></li>
            <li><a href="#"><i class="fa fa-youtube"></i></a></li>
            <li><a href="#"><i class="fa fa-linkedin-square"></i></a></li>
         </ul>
        </div>
    </section>
    <section class="footer-bottom">
       <p>copyright &copy;2023 <a href="#">Snoutsy.</a></p>
    </section>

    <script src="https://kit.fontawesome.com/cb8535f973.js" crossorigin="anonymous"></script>
    <script src="../js/script.js"></script>
    
    <!-- Firebase Authentication for Buy Page -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAZnkTV-mK0F7Q4Fm5OeK_vRPHFgGt6Gms",
            authDomain: "snoutsy-df81c.firebaseapp.com",
            projectId: "snoutsy-df81c",
            storageBucket: "snoutsy-df81c.firebasestorage.app",
            messagingSenderId: "636456747643",
            appId: "1:636456747643:web:f62ed4b7fe0b3217b998de",
            measurementId: "G-G13VVSSN6F"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Get DOM elements
        const loginLink = document.getElementById('login-link');
        const userInfo = document.getElementById('user-info');
        const userPhoto = document.getElementById('user-photo');
        const userName = document.getElementById('user-name');
        const logoutBtn = document.getElementById('logout-btn');
        const petsGrid = document.getElementById('pets-grid');

        // Function to update UI based on auth state
        function updateUI(user) {
            if (user) {
                loginLink.style.display = 'none';
                userInfo.style.display = 'flex';
                userPhoto.src = user.photoURL || 'https://via.placeholder.com/40';
                userPhoto.alt = user.displayName || 'User';
                userName.textContent = user.displayName || 'User';
            } else {
                loginLink.style.display = 'block';
                userInfo.style.display = 'none';
            }
        }

        // Monitor auth state changes
        onAuthStateChanged(auth, (user) => {
            updateUI(user);
        });

        // Logout functionality
        logoutBtn?.addEventListener('click', async () => {
            try {
                await signOut(auth);
                localStorage.removeItem('user');
                window.location.href = './login.html';
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Error signing out. Please try again.');
            }
        });

        // Load pets from localStorage (temporary - will be replaced with DB)
        function loadPets() {
            const pets = JSON.parse(localStorage.getItem('pets') || '[]');
            
            if (pets.length === 0) {
                petsGrid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-dog" style="font-size: 5rem; color: #ccc; margin-bottom: 1rem;"></i>
                        <h3>No pets available yet</h3>
                        <p>Check back soon for new pet listings!</p>
                    </div>
                `;
                return;
            }

            petsGrid.innerHTML = pets.map(pet => `
                <div class="pet-card" data-type="${pet.type}" data-price="${pet.price}">
                    <div class="pet-image">
                        <img src="${pet.image || '../assets/Pet1.png'}" alt="${pet.name}">
                        <span class="pet-type-badge">${pet.type}</span>
                    </div>
                    <div class="pet-card-content">
                        <h3>${pet.name}</h3>
                        <p class="pet-breed">${pet.breed}</p>
                        <p class="pet-description">${pet.description || 'No description available'}</p>
                        <div class="pet-details">
                            <span><i class="fas fa-calendar"></i> ${pet.age || 'N/A'}</span>
                            <span><i class="fas fa-venus-mars"></i> ${pet.gender || 'N/A'}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${pet.location || 'N/A'}</span>
                        </div>
                        <div class="pet-price">
                            <span class="price">₹${pet.price?.toLocaleString() || '0'}</span>
                        </div>
                        <button class="btn-contact" onclick="contactSeller('${pet.sellerId}', '${pet.name}')">
                            <i class="fas fa-phone"></i> Contact Seller
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Search and filter functionality
        document.getElementById('search-input')?.addEventListener('input', filterPets);
        document.getElementById('filter-type')?.addEventListener('change', filterPets);
        document.getElementById('filter-price')?.addEventListener('change', filterPets);

        function filterPets() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const typeFilter = document.getElementById('filter-type').value;
            const priceFilter = document.getElementById('filter-price').value;
            const petCards = document.querySelectorAll('.pet-card');

            petCards.forEach(card => {
                const petName = card.querySelector('h3').textContent.toLowerCase();
                const petType = card.getAttribute('data-type');
                const petPrice = parseInt(card.getAttribute('data-price'));

                const matchesSearch = petName.includes(searchTerm);
                const matchesType = typeFilter === 'all' || petType === typeFilter;
                const matchesPrice = priceFilter === 'all' || checkPriceRange(petPrice, priceFilter);

                if (matchesSearch && matchesType && matchesPrice) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function checkPriceRange(price, range) {
            switch(range) {
                case '0-5000': return price >= 0 && price <= 5000;
                case '5000-10000': return price > 5000 && price <= 10000;
                case '10000-20000': return price > 10000 && price <= 20000;
                case '20000+': return price > 20000;
                default: return true;
            }
        }

        // Contact seller function
        window.contactSeller = function(sellerId, petName) {
            alert(`Contacting seller for ${petName}. This feature will be connected to the database.`);
        };

        // Load pets on page load
        loadPets();
    </script>
</body>
</html>

